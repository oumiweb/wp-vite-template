# WordPress 設定ガイド

テーマ利用に必要な、WordPress の基本設定と固定ページ・投稿の作り方をまとめています。必要なプラグインは初期設定に含め、内容は絞っています。

**テンプレート上のデモについて**  
「news」（通常投稿一覧）や「works」（制作実績）は、テンプレート上のデモとして作成しています。案件やチームのルールに応じて、投稿タイプ名・スラッグ・URL・テンプレートを適宜変更してかまいません。

---

## 目次

1. [初期設定](#初期設定)
2. [必要なプラグイン](#必要なプラグイン)
3. [パーマリンク設定](#パーマリンク設定)
4. [カスタム投稿タイプ（制作実績）](#カスタム投稿タイプ制作実績)
5. [ACF 設定](#acf設定)
6. [固定ページの作成](#固定ページの作成)
7. [投稿・制作実績の作成](#投稿制作実績の作成)
8. [メニュー設定](#メニュー設定)
9. [トラブルシューティング](#トラブルシューティング)

---

## 初期設定

### 1. WordPress 環境の起動

```bash
yarn wp-start
```

初回はコア・プラグインの取得に時間がかかることがあります。

### 2. 管理画面にログイン

- **URL**: `http://localhost:8888/wp-admin`
- **ユーザー名**: `admin`
- **パスワード**: `password`
- **言語設定**: `.wp-env.json` の `WPLANG: "ja"` 設定により、既に日本語になっています

### 3. テーマの有効化

**自動化**: `yarn wp-init` を実行すると、テーマの有効化も自動で実行されます。

**手動で有効化する場合**:

1. **外観** → **テーマ**
2. プロジェクト名（ディレクトリ名）のテーマを有効化

### 4. プラグインの有効化

`yarn wp-start` 時に `.wp-env.json` の一覧からプラグインがインストールされます。管理画面の **プラグイン** → **インストール済みプラグイン** で、必要なプラグインが有効になっているか確認してください。

---

## 必要なプラグイン

テーマの前提として、以下のプラグインを初期設定に含めています。`functions-lib/func-plugins.php`（TGMPA）および `.wp-env.json` で登録されており、`yarn wp-start` で導入されます。

| プラグイン | 役割 |
|------------|------|
| **WP Multibyte Patch** | 日本語の文字化け防止 |
| **SEO Simple Pack** | メタタグ・SEO 設定 |
| **Advanced Custom Fields** | カスタムフィールド（テーマは acf-json で管理） |
| **Custom Post Type UI** | カスタム投稿タイプ・タクソノミーの登録（制作実績 works / works_category 用） |
| **Contact Form 7** | お問い合わせフォーム（`page-contact.php` でショートコード参照） |
| **Breadcrumb NavXT** | パンくずリスト（構造化データ・表示用） |
| **Show Current Template** | 開発用（表示中のテンプレート名の確認）。任意。 |
| **WPvivid Backup Plugin** | バックアップ。任意。 |

カスタム投稿タイプ（制作実績など）は **プラグインで作成する想定** です。このテーマでは CPT UI で「works」「works_category」を登録し、`archive-works.php` / `single-works.php` が利用されます。

---

## パーマリンク設定

1. **設定** → **パーマリンク設定**
2. **投稿名** を選択（例: `/%postname%/`）
3. **変更を保存** をクリック

設定変更後は、**設定** → **パーマリンク設定** で再度「変更を保存」をクリックしてリライトルールを反映させてください。

---

## カスタム投稿タイプ（制作実績）

カスタム投稿タイプは **プラグインで作成する想定** です。このテーマでは **Custom Post Type UI** で次を登録します。

- **投稿タイプ**: `works`（制作実績）。アーカイブあり・スラッグ `works` 推奨。
- **タクソノミー**: `works_category`（制作実績カテゴリー）。`works` に紐付け。

登録後、テーマの `archive-works.php`（一覧）と `single-works.php`（詳細）が使われます。これらはデモ用の構成なので、案件に合わせて変更してかまいません。

- **一覧**: `/works/` → `archive-works.php`
- **詳細**: `/works/{スラッグ}/` → `single-works.php`

制作実績の投稿は **制作実績** → **新規追加** から。ACF フィールド・アイキャッチ・制作実績カテゴリーを設定して公開します。

---

## ACF 設定

フィールドグループの定義は、テーマの `acf-json` に JSON で保存されます。

- 管理画面でフィールドグループを **更新** すると、`wordpress/themes/{THEME_NAME}/acf-json/` に JSON が保存される
- JSON を直接編集した場合は、**カスタムフィールド** → **フィールドグループ** で「同期が利用できます」をクリックして DB に反映する

詳細は [ACF_GUIDE.md](./ACF_GUIDE.md) を参照してください。

---

## 固定ページの作成

### お問い合わせページ

1. **固定ページ** → **新規追加**
2. タイトルを入力（例: お問い合わせ）
3. **ページ属性** → **テンプレート** で **Contact** を選択
4. **公開** をクリック
5. スラッグ（例: `contact`）を確認し、必要なら **設定** → **パーマリンク** で確認

お問い合わせフォーム（Contact Form 7）のショートコードは、テーマの `page-contact.php` で固定 ID を参照しています。フォームの作成・設定はプラグイン側で行います。

#### 販売後特典で SQL を渡す場合

- テーマは CF7 のフォーム ID `c86f2bc` を参照。特典 SQL に同じ ID のフォームとお問い合わせ固定ページを含めれば、インポート後にそのまま表示されます。詳しくはテーマの `page-contact.php` 内コメントを参照してください。

### ニュース一覧（投稿一覧）の URL

1. **設定** → **表示設定**
2. **投稿ページ** で、ニュース一覧として表示したい固定ページ（例: スラッグ `news`）を選択
3. **変更を保存** をクリック

選択した固定ページのスラッグがそのまま URL になります（例: `/news/`）。表示には `home.php` と `template-parts/page-news-list` が使われます。詳細は [TEMPLATE_GUIDE.md](./TEMPLATE_GUIDE.md) を参照してください。

---

## 投稿・制作実績の作成

### 通常投稿（ニュース）

1. **投稿** → **新規追加**
2. タイトル・本文・ACF フィールド・アイキャッチ・カテゴリー・タグを入力
3. **公開** をクリック

### 制作実績

1. **制作実績** → **新規追加**
2. タイトル・ACF フィールド（クライアント名、制作期間、使用技術など）・本文・アイキャッチ・制作実績カテゴリーを入力
3. **公開** をクリック

### 動作確認の目安

- 通常投稿: 表示設定の「投稿ページ」で指定した URL（例: `/news/`）で一覧、`/news/{スラッグ}/` で詳細
- 制作実績: `/works/` で一覧、`/works/{スラッグ}/` で詳細

---

## メニュー設定

1. **外観** → **メニュー**
2. 新しいメニューを作成し、ページ・カスタムリンクを追加
3. **メニューを保存** をクリック

メニューの表示位置（ヘッダー・フッター等）は、テーマの `functions-lib/func-base.php` で `register_nav_menus` を登録すると利用できます。

---

## トラブルシューティング

### URL がおかしい

- **設定** → **パーマリンク設定** で「変更を保存」を再度クリックしてリライトルールを反映する

### カスタム投稿タイプの一覧・詳細が表示されない

- リライトルールのフラッシュ（パーマリンク設定の再保存）
- キャッシュのクリア

### スタイルが当たらない

- `yarn build:wp` を実行し、テーマの `assets/` にビルド済み CSS/JS が出ているか確認
- 開発時は `WP_DEBUG` が true なら Vite サーバー（`yarn dev`）の資産を参照しているか確認

### ACF の JSON が保存されない

- テーマの `acf-json` ディレクトリのパーミッション（755 等）を確認
- `functions-lib/func-acf.php` が読み込まれているか確認

---

## 関連ドキュメント

- [ACF_GUIDE.md](./ACF_GUIDE.md) — ACF 設定・JSON 同期
- [TEMPLATE_GUIDE.md](./TEMPLATE_GUIDE.md) — テンプレートの使い分け
- [README.md](../README.md) — プロジェクト概要・コマンド一覧
